Система видеонаблюдения на основе YOLO и FFmpeg

Это система видеонаблюдения, которая использует YOLO для детекции объектов и FFmpeg для захвата и обработки видео. Она поддерживает обнаружение движения, объектов, отправку уведомлений в Telegram и запись видео.
Основные функции

    Детекция движения:

        Анализирует кадры на предмет движения с помощью алгоритма вычитания фона.

        Логирует зону, где обнаружено движение (например, "слева вверху").

        Визуализирует область движения на скриншотах.

    Детекция объектов:

        Использует YOLO для обнаружения объектов (люди, животные и т.д.).

        Логирует тип объекта, точность и его расположение на кадре.

        Поддерживает фильтрацию объектов по типам (например, только люди и кошки).

    Отправка уведомлений в Telegram:

        Отправляет фото и видео в Telegram при обнаружении движения или объектов.

        Поддерживает настройку чата для каждой камеры.

    Запись видео:

        Записывает видео при обнаружении движения или объектов.

        Поддерживает буферизацию на 10 секунд.

    Тестовые функции:

        Захват тестового кадра и видео при старте системы.

Требования

    Оборудование:

        Процессор: Intel i7-2700K или выше.

        ОЗУ: 8 ГБ или больше.

        Жёсткий диск: для хранения буфера и записей.

    Программное обеспечение:

        Python 3.8 или выше.

        FFmpeg.

        Библиотеки: opencv-python, ultralytics, aiohttp, numpy, yaml.

Установка

    Установите зависимости:
    bash
    Copy

    pip install opencv-python ultralytics aiohttp numpy yaml

    Установите FFmpeg:

        Для Ubuntu:
        bash
        Copy

        sudo apt install ffmpeg

        Для Windows: скачайте с официального сайта.

    Склонируйте репозиторий:
    bash
    Copy

    git clone https://github.com/your-repo/video-surveillance-system.git
    cd video-surveillance-system

    Настройте конфигурационные файлы:

        config/cameras.yaml — настройки камер.

        config/telegram.yaml — настройки Telegram.

    Запустите систему:
    bash
    Copy

    python main.py

Конфигурация
1. Настройки камер (config/cameras.yaml)

Пример конфигурации камеры:
yaml
Copy

cameras:
  - id: 1
    name: "Балкон"
    rtsp_url: "rtsp://192.168.2.5:554/user=video_password=video_channel=0_stream=0&onvif=0.sdp?real_stream"
    width: 1920
    height: 1080
    fps: 15
    enabled: true
    detect_motion: true  # Включить детекцию движения
    detect_objects: true  # Включить детекцию объектов
    object_confidence: 0.5  # Порог уверенности для объектов
    telegram_chat_id: "-1001234567890"  # ID чата в Telegram
    send_photo: true  # Отправлять фото в Telegram
    send_video: true  # Отправлять видео в Telegram
    draw_boxes: true  # Рисовать рамки вокруг объектов
    test_frame_on_start: true  # Захватить тестовый кадр при старте
    test_video_on_start: true  # Захватить тестовое видео при старте
    motion_sensitivity: 0.2  # Чувствительность детекции движения
    record_audio: false  # Записывать аудио
    reconnect_attempts: 5  # Количество попыток переподключения
    reconnect_delay: 10  # Задержка между попытками переподключения
    show_live_feed: false  # Показывать live-видео
    object_types: ["person", "cat", "dog"]  # Типы объектов для детекции

2. Настройки Telegram (config/telegram.yaml)

Пример конфигурации Telegram:
yaml
Copy

bot_token: "123456789:ABCdefGhIJKlmNoPQRstuVWXyz"  # Токен бота

Примеры логов

    Детекция движения:
    Copy

    2025-03-07 18:07:27,096 - INFO - Камера Балкон: Движение обнаружено в зоне слева вверху
    2025-03-07 18:07:27,100 - INFO - Камера Балкон: Попытка отправки фото в Telegram...

    Детекция объектов:
    Copy

    2025-03-07 18:07:27,105 - INFO - Камера Балкон: Обнаружен объект 'person' с точностью 0.85, расположение: слева вверху
    2025-03-07 18:07:27,110 - INFO - Камера Балкон: Обнаружен объект 'cat' с точностью 0.72, расположение: справа внизу

    Ошибки:
    Copy

    2025-03-07 18:07:27,115 - ERROR - Камера Балкон: Ошибка при захвате кадра FFmpeg: Connection refused

Примеры использования
1. Запуск системы
bash
Copy

python main.py

2. Тестовый кадр

    При старте система захватывает тестовый кадр и отправляет его в Telegram.

3. Тестовое видео

    При старте система захватывает тестовое видео (5 секунд) и отправляет его в Telegram.

4. Отправка фото при движении

    Если движение обнаружено, система отправляет фото в Telegram с указанием зоны движения.

5. Отправка видео при движении

    Если движение подтверждено, система записывает видео (15 секунд) и отправляет его в Telegram.

FAQ
1. Как добавить новую камеру?

    Добавьте новую запись в config/cameras.yaml с уникальным id и настройками камеры.

2. Как изменить чувствительность детекции движения?

    Измените параметр motion_sensitivity в config/cameras.yaml. Чем меньше значение, тем выше чувствительность.

3. Как отключить детекцию объектов?

    Установите detect_objects: false в настройках камеры.

4. Как изменить типы объектов для детекции?

    Измените список object_types в настройках камеры. Например:
    yaml
    Copy

    object_types: ["person", "car"]

Лицензия

Этот проект распространяется под лицензией MIT. Подробности см. в файле LICENSE.
